# Review

저장 프로그램
```
SQL은 비절차적 언어로 다른 응용프로그램처럼 조건문, 반복문을 사용할 수 없다.
절차적으로 처리하기 위한 기능을 저장프로그램으로 제공한다.
DMBS 내부에 컴파일되어 캐시에 저장되어 실행되는 프로그램이다.
제어명령과 변수도 지원한다.
```

종류
- 프로시저
- 함수 : 복잡한 프로그램이 가능(프로시저와 유사)
- 트리거 : 특정 개체에 발생하는 이벤트에 따라 자동으로 동작하다록 설계

형식
- 정의부분 : procedure 프로시저명(매개변수) 프로시저명은 유일해야한다.
- 본문부분 begin ~ [begin ~ end] end

## 변수
- 사용자변수 : @~로 시작 : @name = "홍길동" --- 어디서든 불러 사용가능
- 로컬변수 : begin ~ end안에서 declare 변수, 변수,, 데이터타입 [default 값]
- 초기값 설정 : set 변수 = 값 또는 select 상수 into 변수 from 테이블

### 저장프로시저
CREATE PROCEDURE 프로시정 ( IN | OUT | INOUT 매개변수 데이터타입 [DEFAULT],, )
```
BEGIN
  지역변수선언 / 초기화
  SQL 문장...................;
  IF 조건식 then SQL문 [ELSE 조건식 THEN SQL문] [ELSE SQL문] END IF;
  CASE 받은변수 WHEN 비교변수 THEN SQL문 [WHEN 비교변수 THEN SQL문] [ELSE~] END CASE;
  CASE WHEN 조건식 THEN SQL문 ,,, [ELSE SQL문]
  WHILE 조건식 DO SQL문 END WHILE;
  REPEAT SQL문 UNTIL 조건식 END REPEAT;
  Loop이름 : LOOP ~~~ END LOOP;
  [다른 프로시저 호출가능]
END
```

CALL 프로시저명 (매개변수, 매개변수,,,@사용자매개변수)

-----------------------------------------------------------------------------------------------

# 오늘의 학습목표
- 트리거/트렌잭션을 이해하고 구현할 수 있다.

# 공지사항
- 데이터베이스 구현 / SQL활용 / SQL응용 평가예정
- 평가일시 : 5/8(월)


### 이론
```mysql
/*
	트리거(Trigger)
			- 어떤 테이블의 데이터가 변경될 때 자동으로 지정된 애플리케이션이 동작되거나
			- 다른 테이블의 데이터를 변경하도록 설계된 저장 프로시저의 특별한 형태이다.
			- 테이블에서 수정,삭제,삽입이 발생하면 트리거가 자동호출되어 전체적인 데이터베이스의
				구조를 바로 잡는 역할을 한다.
			- 매개변수를 사용할 수 없다.
        
		활용
			- 데이터베이스의 무결성을 위해 테이블 정의시 제약조건을 명시하는 방법을 사용한다.
            		- 복잡한 데이터의 적합성 검사에 호라용
          	        - >> 광범위한 참조 무결성 검사에 활용된다.
            
		단점
			- 연속적인 트리거 실행은 시스템의 성능을 떨어트린다.
           		- 무한루프를 돌게 할 수도 있다. >> 특별히 주의해야함!!
            
		종류
			- 입력할때...		before insert, after insert
          		- 수정할때...		before update, after update
          		- 삭제할때...		before delete, after delete
            
		구현
			CREATE TRIGGER 트리거명 발생시점 이벤트종류
			ON 테이블
                   	for each row	// 각각의 행(레코드)에 대해서
                    	begin
				SQL문		// old.컬럼, new.컬럼
			end
                    
			* old : 변경이 가해지기 전 레코드 - old테이블
			  new : 변경이 가해진 후 레코드 - new테이블
                    
                    - INSERT	new
                    - UPDATE	old, new
                    - DELETE	old
*/
```

## 조금이따 해보기
```
# 특정 강의를 삭제하면... 수강신청테이블에서 해당 수강신청항목을 삭제하는 트리거를 구현하시오.
```

### trigger 연습1
```mysql
# 학생테이블에서 학년컬럼에 학년을 수정하려고 하는데... 1~4 범위를 벗어난 입력값이 있을떄
# 처리해야할 일을 트리거로 작성
delimiter $$
CREATE TRIGGER before_학년_update BEFORE UPDATE ON 학생
FOR EACH ROW BEGIN
    IF NEW.학년 < 1 THEN
        SET NEW.학년 = 1;
    ELSEIF NEW.학년 > 4 THEN
        SET NEW.학년 = 4;
    END IF;
END $$
delimiter ;

select * 
from 학생;


update 
학생 set 학년 = 0
where 학생번호 = '201258047';
```


